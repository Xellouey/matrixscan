<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–µ—Ç–µ–π</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–µ—Ç–µ–π - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –º–∞–≥–∞–∑–∏–Ω–æ–≤">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#2196F3">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="format-detection" content="telephone=no">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/icon-192.png">
    <link rel="shortcut icon" href="/icon-192.png">

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            padding: 16px;
            background: linear-gradient(135deg, #2196F3, #1976D2);
            border-radius: 12px;
            color: white;
        }

        .header h1 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .menu-item {
            background: var(--tg-theme-button-color, #2196F3);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 56px;
        }

        .menu-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .back-button {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000000);
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            cursor: pointer;
            font-size: 14px;
        }

        .list-item {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .list-item:hover {
            background: var(--tg-theme-button-color, #2196F3);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .store-item {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .store-item:hover {
            background: var(--tg-theme-button-color, #2196F3);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .store-item.checked {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .store-item .store-number {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .store-item .store-address {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.3;
        }

        .store-item .store-status {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 20px;
        }

        .nomenclature-item {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nomenclature-item.checked {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .nomenclature-item .icon {
            font-size: 20px;
            min-width: 24px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--tg-theme-hint-color, #999999);
        }

        .spinner {
            border: 3px solid var(--tg-theme-hint-color, #f3f3f3);
            border-top: 3px solid var(--tg-theme-button-color, #2196F3);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .report-info {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .success-message {
            background: #4CAF50;
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 16px;
        }

        .error-message {
            background: #f44336;
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 16px;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 24px;
        }

        .control-button {
            padding: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
        }

        .save-button {
            background: #4CAF50;
            color: white;
        }

        .send-button {
            background: #FF9800;
            color: white;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 16px 0;
            padding: 12px;
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 8px;
        }

        .pagination-button {
            background: var(--tg-theme-button-color, #2196F3);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            min-width: 80px;
        }

        .pagination-button:disabled {
            background: var(--tg-theme-hint-color, #cccccc);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .pagination-info {
            font-size: 14px;
            color: var(--tg-theme-text-color, #000000);
            text-align: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞ */
        .barcode-scan-button {
            background: linear-gradient(135deg, #FF6B35, #F7931E);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 16px auto;
            width: 80%;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .barcode-scan-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 107, 53, 0.4);
        }

        .barcode-scan-button:active {
            transform: translateY(0);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–∫–∞–Ω–µ—Ä–∞ */
        .scanner-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .scanner-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 95%;
            max-height: 95%;
            position: relative;
            overflow-y: auto;
        }

        #scanner-video-container {
            width: 100%;
            max-width: 400px;
            height: 300px;
            margin: 0 auto;
            position: relative;
            border: 2px solid #FF6B35;
            border-radius: 8px;
            overflow: hidden;
        }

        #scanner-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .scanner-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        #barcode-result {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            display: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
        .calendar-container {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .calendar-nav {
            background: var(--tg-theme-button-color, #2196F3);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
        }

        .calendar-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .calendar-weekday {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--tg-theme-hint-color, #999999);
            padding: 8px 4px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 6px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .calendar-day:hover:not(.disabled):not(.empty) {
            background: var(--tg-theme-button-color, #2196F3);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .calendar-day.today {
            background: #4CAF50;
            color: white;
            font-weight: 600;
        }

        .calendar-day.selected {
            background: var(--tg-theme-button-color, #2196F3);
            color: var(--tg-theme-button-text-color, #ffffff);
            font-weight: 600;
        }

        .calendar-day.disabled {
            background: var(--tg-theme-hint-color, #f0f0f0);
            color: var(--tg-theme-subtitle-text-color, #999999);
            cursor: not-allowed;
        }

        .calendar-day.empty {
            border: none;
            background: transparent;
            cursor: default;
        }
    </style>
</head>

<body>
    <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
    <div id="main-screen" class="screen active">
        <div class="header">
            <h1>üè™ –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–µ—Ç–µ–π</h1>
            <p>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</p>
        </div>

        <div class="menu-grid">
            <button class="menu-item" onclick="startMonitoring()">
                üöÄ –ù–∞—á–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
            </button>
            <button class="menu-item" onclick="showTodayReport()">
                üìä –û—Ç—á–µ—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            </button>
            <button class="menu-item" onclick="showPeriodReport()">
                üìÖ –û—Ç—á–µ—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥
            </button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ä–µ–≥–∏–æ–Ω–∞ -->
    <div id="region-screen" class="screen">
        <button class="back-button" onclick="showMainScreen()">
            ‚¨ÖÔ∏è –ù–∞–∑–∞–¥
        </button>

        <div class="header">
            <h1>üåç –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞</h1>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</p>
        </div>

        <div id="region-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤...</p>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Å–µ—Ç–∏ -->
    <div id="network-screen" class="screen">
        <button class="back-button" onclick="showRegionScreen()">
            ‚¨ÖÔ∏è –ö —Ä–µ–≥–∏–æ–Ω–∞–º
        </button>

        <div class="header">
            <h1>üè¨ –í—ã–±–æ—Ä —Å–µ—Ç–∏</h1>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é —Å–µ—Ç—å</p>
        </div>

        <div id="network-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ç–µ–π...</p>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –º–∞–≥–∞–∑–∏–Ω–∞ -->
    <div id="store-screen" class="screen">
        <button class="back-button" onclick="showNetworkScreen()">
            ‚¨ÖÔ∏è –ö —Å–µ—Ç—è–º
        </button>

        <div class="header">
            <h1>üè™ –í—ã–±–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞</h1>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</p>
        </div>

        <!-- –ü–æ–∏—Å–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤ -->
        <div class="search-container" style="margin-bottom: 16px;">
            <input type="text" id="store-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –∞–¥—Ä–µ—Å—É –º–∞–≥–∞–∑–∏–Ω–∞..."
                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;"
                oninput="searchStores()" />
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div id="pagination-container" class="pagination-container" style="display: none;">
            <button id="prev-page" class="pagination-button" onclick="changePage(-1)">
                ‚¨ÖÔ∏è –ù–∞–∑–∞–¥
            </button>
            <div id="pagination-info" class="pagination-info">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1
            </div>
            <button id="next-page" class="pagination-button" onclick="changePage(1)">
                –í–ø–µ—Ä–µ–¥ ‚û°Ô∏è
            </button>
        </div>

        <div id="store-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤...</p>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã -->
    <div id="nomenclature-screen" class="screen">
        <button class="back-button" onclick="showStoreScreen()">
            ‚¨ÖÔ∏è –ö –º–∞–≥–∞–∑–∏–Ω–∞–º
        </button>

        <div class="header">
            <h1>üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã</h1>
            <p id="store-info">–ú–∞–≥–∞–∑–∏–Ω</p>
        </div>

        <div class="report-info">
            <p>‚úÖ –û—Ç–º–µ—Ç—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω–µ</p>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞ -->
        <button class="barcode-scan-button" onclick="openBarcodeScanner()">
            üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —à—Ç—Ä–∏—Ö-–∫–æ–¥
        </button>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div id="barcode-result">
            <strong>üîç –ù–∞–π–¥–µ–Ω —Ç–æ–≤–∞—Ä:</strong>
            <div id="found-product"></div>
        </div>

        <div id="nomenclature-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã...</p>
            </div>
        </div>

        <div class="control-buttons">
            <button class="control-button save-button" onclick="saveProgress()">
                ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è
            </button>
            <button class="control-button send-button" onclick="showReportPreview()">
                üì§ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ª–∞–¥–∫–∏ -->
        <div style="margin-top: 20px; text-align: center;">
            <button onclick="toggleDebugMode()"
                style="padding: 8px 16px; background: #666; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">
                üîç –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –æ—Ç–ª–∞–¥–∫—É
            </button>
        </div>

        <!-- –õ–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ -->
        <div id="debug-log"
            style="margin-top: 10px; padding: 10px; background: #f0f0f0; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; display: none; border-radius: 4px;">
            <strong>üîç –õ–æ–≥ –æ—Ç–ª–∞–¥–∫–∏:</strong><br>
            <div id="debug-content"></div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–∞ -->
    <div id="report-preview-screen" class="screen">
        <button class="back-button" onclick="showNomenclatureScreen()">
            ‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ
        </button>

        <div class="header">
            <h1>üìä –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞</h1>
            <p id="preview-store-info">–ú–∞–≥–∞–∑–∏–Ω</p>
        </div>

        <div id="report-summary" class="report-info">
            <!-- –°–≤–æ–¥–∫–∞ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ JavaScript -->
        </div>

        <div style="margin: 20px 0;">
            <label for="inspector-name" style="display: block; margin-bottom: 8px; font-weight: 500;">
                üë§ –§–ò–û –ø—Ä–æ–≤–µ—Ä—è—é—â–µ–≥–æ:
            </label>
            <input type="text" id="inspector-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –§–ò–û..."
                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; margin-bottom: 15px;" />

            <label for="report-comment" style="display: block; margin-bottom: 8px; font-weight: 500;">
                üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ç—á–µ—Ç—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
            </label>
            <textarea id="report-comment" placeholder="–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ç—á–µ—Ç—É..."
                style="width: 100%; height: 80px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
        </div>

        <div style="margin: 20px 0;">
            <button onclick="downloadExcelPreview()"
                style="width: 100%; padding: 15px; background: #2196F3; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
                üìä –°–∫–∞—á–∞—Ç—å Excel –æ—Ç—á–µ—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            </button>
        </div>

        <div class="control-buttons">
            <button class="control-button save-button" onclick="showNomenclatureScreen()">
                ‚¨ÖÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ
            </button>
            <button class="control-button send-button" onclick="finalSaveAndSend()">
                üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –≤ Telegram
            </button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –æ—Ç—á–µ—Ç–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è -->
    <div id="today-report-screen" class="screen">
        <button class="back-button" onclick="showMainScreen()">
            ‚¨ÖÔ∏è –ù–∞–∑–∞–¥
        </button>

        <div class="header">
            <h1>üìä –û—Ç—á–µ—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h1>
            <p id="today-date"></p>
        </div>

        <div id="today-report-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –æ—Ç—á–µ—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ -->
    <div id="period-report-screen" class="screen">
        <button class="back-button" onclick="showMainScreen()">
            ‚¨ÖÔ∏è –ù–∞–∑–∞–¥
        </button>

        <div class="header">
            <h1>üìÖ –û—Ç—á–µ—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥</h1>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è –æ—Ç—á–µ—Ç–∞</p>
        </div>

        <div id="period-step" class="report-info">
            <p>–®–∞–≥ 1/2: –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –¥–∞—Ç—É</p>
        </div>

        <div id="period-report-content">
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="changeYear(-1)">‚Äπ‚Äπ</button>
                    <button class="calendar-nav" onclick="changeMonth(-1)">‚Äπ</button>
                    <div id="calendar-title" class="calendar-title">–Ø–Ω–≤–∞—Ä—å 2025</div>
                    <button class="calendar-nav" onclick="changeMonth(1)">‚Ä∫</button>
                    <button class="calendar-nav" onclick="changeYear(1)">‚Ä∫‚Ä∫</button>
                </div>

                <div class="calendar-weekdays">
                    <div class="calendar-weekday">–ü–Ω</div>
                    <div class="calendar-weekday">–í—Ç</div>
                    <div class="calendar-weekday">–°—Ä</div>
                    <div class="calendar-weekday">–ß—Ç</div>
                    <div class="calendar-weekday">–ü—Ç</div>
                    <div class="calendar-weekday">–°–±</div>
                    <div class="calendar-weekday">–í—Å</div>
                </div>

                <div id="calendar-grid" class="calendar-grid">
                    <!-- –î–Ω–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–∫–∞–Ω–µ—Ä–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞ -->
    <div id="scanner-modal" class="scanner-modal">
        <div class="scanner-content">
            <span class="scanner-close" onclick="closeBarcodeScanner()">&times;</span>
            <h3 style="text-align: center; margin-bottom: 20px;">üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞</h3>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∏–¥–µ–æ -->
            <div id="scanner-video-container">
                <div id="scanner-overlay"
                    style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 100px; border: 2px solid #FF6B35; border-radius: 4px; z-index: 10;">
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div style="text-align: center; margin: 20px 0;">
                <button id="start-scan-btn" onclick="startScanning()"
                    style="padding: 12px 24px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin: 5px;">
                    ‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </button>
                <button id="stop-scan-btn" onclick="stopScanning()"
                    style="padding: 12px 24px; background: #f44336; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin: 5px; display: none;">
                    ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                </button>
            </div>

            <!-- –†—É—á–Ω–æ–π –≤–≤–æ–¥ -->
            <div style="text-align: center; margin: 20px 0;">
                <input type="text" id="manual-barcode" placeholder="–í–≤–µ–¥–∏—Ç–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..."
                    style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 10px;" />
                <button onclick="searchByBarcode()"
                    style="width: 100%; padding: 12px; background: #2196F3; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
                    üîç –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä
                </button>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                <div style="margin-top: 15px;">
                    <div style="color: #666; margin-bottom: 10px; font-size: 14px;">‚ö° –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫:</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button onclick="quickSearch('123')"
                            style="background: #4CAF50; color: white; border: none; padding: 10px; border-radius: 5px; font-size: 14px; cursor: pointer;">123
                            - –ú–æ–ª–æ–∫–æ</button>
                        <button onclick="quickSearch('456')"
                            style="background: #4CAF50; color: white; border: none; padding: 10px; border-radius: 5px; font-size: 14px; cursor: pointer;">456
                            - –•–ª–µ–±</button>
                        <button onclick="quickSearch('–º–æ–ª–æ–∫–æ')"
                            style="background: #2196F3; color: white; border: none; padding: 10px; border-radius: 5px; font-size: 14px; cursor: pointer;">ü•õ
                            –º–æ–ª–æ–∫–æ</button>
                        <button onclick="quickSearch('—Ö–ª–µ–±')"
                            style="background: #2196F3; color: white; border: none; padding: 10px; border-radius: 5px; font-size: 14px; cursor: pointer;">üçû
                            —Ö–ª–µ–±</button>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç—É—Å -->
            <div id="scanner-status" style="text-align: center; color: #666; margin: 10px 0; font-size: 14px;">
                –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ" –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤—Ä—É—á–Ω—É—é
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = null;

        try {
            if (typeof window !== 'undefined' && window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;
                tg.expand();
                tg.ready();
                console.log('‚úÖ Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } else {
                console.log('‚ö†Ô∏è Telegram Web App –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback');
                tg = {
                    ready: () => { },
                    expand: () => { },
                    MainButton: {
                        hide: () => { },
                        show: () => { },
                        setText: () => { },
                        onClick: () => { }
                    },
                    BackButton: { hide: () => { }, show: () => { } },
                    showAlert: (msg) => alert(msg),
                    themeParams: {}
                };
            }
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram Web App:', error);
            tg = {
                ready: () => { },
                expand: () => { },
                MainButton: {
                    hide: () => { },
                    show: () => { },
                    setText: () => { },
                    onClick: () => { }
                },
                BackButton: { hide: () => { }, show: () => { } },
                showAlert: (msg) => alert(msg),
                themeParams: {}
            };
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentRegion = null;
        let currentNetwork = null;
        let currentStore = null;
        let nomenclatureItems = [];
        let checkedItems = new Set();
        let debugMode = false;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        let calendarStep = 1;
        let selectedStartDate = null;
        let selectedEndDate = null;
        let currentDate = new Date();

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showMainScreen() {
            showScreen('main-screen');
            tg.MainButton.hide();
        }

        function showRegionScreen() {
            showScreen('region-screen');
            loadRegions();
        }

        function showNetworkScreen() {
            showScreen('network-screen');
            loadNetworks();
        }

        function showStoreScreen() {
            showScreen('store-screen');
            loadStores();
        }

        function showNomenclatureScreen() {
            showScreen('nomenclature-screen');
            loadNomenclature();
        }

        function showReportPreview() {
            if (!currentStore || nomenclatureItems.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞');
                return;
            }

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞–≥–∞–∑–∏–Ω–µ
            document.getElementById('preview-store-info').innerHTML = `
                <strong>üè™ ${currentStore.name}</strong><br>
                <small>üìç ${currentStore.address}</small>
            `;

            // –°–æ–∑–¥–∞–µ–º —Å–≤–æ–¥–∫—É –æ—Ç—á–µ—Ç–∞
            const presentCount = checkedItems.size;
            const totalCount = nomenclatureItems.length;
            const percentage = totalCount > 0 ? ((presentCount / totalCount) * 100).toFixed(1) : 0;

            const summaryHtml = `
                <h3>üìà –°–≤–æ–¥–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
                <p><strong>üìÖ –î–∞—Ç–∞:</strong> ${new Date().toLocaleDateString('ru-RU')}</p>
                <p><strong>üè™ –ú–∞–≥–∞–∑–∏–Ω:</strong> ${currentStore.name}</p>
                <p><strong>üìç –ê–¥—Ä–µ—Å:</strong> ${currentStore.address}</p>
                <p><strong>üìä –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong> ${totalCount}</p>
                <p><strong>‚úÖ –í –Ω–∞–ª–∏—á–∏–∏:</strong> ${presentCount}</p>
                <p><strong>‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:</strong> ${totalCount - presentCount}</p>
                <p><strong>üìà –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞–ª–∏—á–∏—è:</strong> ${percentage}%</p>
                
                <h4>‚úÖ –¢–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏:</h4>
                <div style="max-height: 150px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 5px; font-size: 12px;">
                    ${Array.from(checkedItems).map(item => `‚Ä¢ ${item}`).join('<br>')}
                </div>
                
                ${totalCount - presentCount > 0 ? `
                <h4>‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã:</h4>
                <div style="max-height: 150px; overflow-y: auto; background: #fff2f2; padding: 10px; border-radius: 5px; font-size: 12px;">
                    ${nomenclatureItems.filter(item => !checkedItems.has(item)).map(item => `‚Ä¢ ${item}`).join('<br>')}
                </div>
                ` : ''}
            `;

            document.getElementById('report-summary').innerHTML = summaryHtml;

            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('inspector-name').value = '';
            document.getElementById('report-comment').value = '';

            showScreen('report-preview-screen');
        }

        async function downloadExcelPreview() {
            if (!currentStore || nomenclatureItems.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞');
                return;
            }

            try {
                // –°–æ–∑–¥–∞–µ–º Excel –æ—Ç—á–µ—Ç —á–µ—Ä–µ–∑ API —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞
                const response = await fetch('/api/create-excel-report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        store_id: currentStore.id,
                        store_name: currentStore.name,
                        checked_items: Array.from(checkedItems),
                        total_items: nomenclatureItems.length
                    })
                });

                const data = await response.json();

                if (data.success && data.report_file) {
                    // –°–∫–∞—á–∏–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
                    const downloadUrl = `/api/download-file?file=${encodeURIComponent(data.report_file)}`;

                    // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                    const link = document.createElement('a');
                    link.href = downloadUrl;
                    link.download = data.report_file.split('/').pop();
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    alert('üìä Excel –æ—Ç—á–µ—Ç —Å–∫–∞—á–∞–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É –∑–∞–≥—Ä—É–∑–æ–∫.');
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }

            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–µ–Ω—é
        function startMonitoring() {
            showRegionScreen();
        }

        function showTodayReport() {
            showScreen('today-report-screen');
            loadTodayReport();
        }

        function showPeriodReport() {
            showScreen('period-report-screen');
            initCalendar();
        }

        // –ö–ê–õ–ï–ù–î–ê–†–¨ - –†–ï–ê–õ–¨–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø
        function initCalendar() {
            calendarStep = 1;
            selectedStartDate = null;
            selectedEndDate = null;
            currentDate = new Date();
            document.getElementById('period-step').innerHTML = '<p>–®–∞–≥ 1/2: –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –¥–∞—Ç—É</p>';
            generateCalendar();
        }

        function generateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å",
                "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            const titleElement = document.getElementById('calendar-title');
            if (titleElement) {
                titleElement.textContent = `${monthNames[month]} ${year}`;
            }

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            let calendarHtml = '';
            const startDay = firstDay === 0 ? 6 : firstDay - 1; // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 0

            // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –≤ –Ω–∞—á–∞–ª–µ
            for (let i = 0; i < startDay; i++) {
                calendarHtml += '<div class="calendar-day empty"></div>';
            }

            // –î–Ω–∏ –º–µ—Å—è—Ü–∞
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === today.toDateString();
                const isFuture = date > today;
                const isSelected = (selectedStartDate && date.toDateString() === selectedStartDate.toDateString()) ||
                    (selectedEndDate && date.toDateString() === selectedEndDate.toDateString());

                let className = 'calendar-day';
                if (isToday) className += ' today';
                if (isFuture) className += ' disabled';
                if (isSelected) className += ' selected';

                const onclick = isFuture ? '' : `onclick="selectDate(${year}, ${month}, ${day})"`;
                calendarHtml += `<button class="${className}" ${onclick}>${day}</button>`;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            const gridElement = document.getElementById('calendar-grid');
            if (gridElement) {
                gridElement.innerHTML = calendarHtml;
            }
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            generateCalendar();
        }

        function changeYear(delta) {
            currentDate.setFullYear(currentDate.getFullYear() + delta);
            generateCalendar();
        }

        function selectDate(year, month, day) {
            const selectedDate = new Date(year, month, day);

            if (calendarStep === 1) {
                selectedStartDate = selectedDate;
                calendarStep = 2;
                document.getElementById('period-step').innerHTML =
                    `<p>–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞: ${selectedDate.toLocaleDateString('ru-RU')}</p><p>–®–∞–≥ 2/2: –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É</p>`;
                generateCalendar();
            } else {
                if (selectedDate < selectedStartDate) {
                    safeShowAlert('–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª—å–Ω–æ–π!');
                    return;
                }
                selectedEndDate = selectedDate;
                generatePeriodReport();
            }
        }

        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function safeShowAlert(message) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Telegram Web App –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –º–µ—Ç–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                if (typeof window !== 'undefined' &&
                    window.Telegram &&
                    window.Telegram.WebApp &&
                    typeof window.Telegram.WebApp.showAlert === 'function') {
                    window.Telegram.WebApp.showAlert(message);
                } else {
                    // Fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π alert
                    alert(message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                // –í —Å–ª—É—á–∞–µ –ª—é–±–æ–π –æ—à–∏–±–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π alert
                alert(message);
            }
        }

        async function generatePeriodReport() {
            const content = document.getElementById('period-report-content');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¥–∞—Ç—ã –≤—ã–±—Ä–∞–Ω—ã
            if (!selectedStartDate || !selectedEndDate) {
                content.innerHTML = `
                    <div class="error-message">
                        ‚ùå –û—à–∏–±–∫–∞: –ù–µ –≤—ã–±—Ä–∞–Ω—ã –¥–∞—Ç—ã –ø–µ—Ä–∏–æ–¥–∞
                    </div>
                `;
                safeShowAlert('–û—à–∏–±–∫–∞: –ù–µ –≤—ã–±—Ä–∞–Ω—ã –¥–∞—Ç—ã –ø–µ—Ä–∏–æ–¥–∞');
                return;
            }

            content.innerHTML = `
                <div class="success-message">
                    ‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥...
                </div>
                <div class="report-info">
                    <h3>üìà –û—Ç—á–µ—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥</h3>
                    <p>–° ${selectedStartDate.toLocaleDateString('ru-RU')} –ø–æ ${selectedEndDate.toLocaleDateString('ru-RU')}</p>
                    <p>–°–æ–∑–¥–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–∞...</p>
                </div>
            `;

            try {
                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞...');

                const response = await fetch('/api/generate-period-report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        start_date: selectedStartDate.toISOString().split('T')[0],
                        end_date: selectedEndDate.toISOString().split('T')[0]
                    })
                });

                console.log('–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç:', response.status);
                const data = await response.json();
                console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);

                if (response.ok && data.success) {
                    content.innerHTML = `
                        <div class="success-message">
                            ‚úÖ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!
                        </div>
                        <div class="report-info">
                            <h3>üìà ${data.message}</h3>
                            <p>üìÅ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ø–∞–ø–∫—É reports/</p>
                            <p>üè™ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –º–∞–≥–∞–∑–∏–Ω–æ–≤: ${data.stores_count}</p>
                        </div>
                        <div style="margin: 20px 0;">
                            <button onclick="downloadPeriodReport()" style="width: 100%; padding: 15px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
                                üìä –°–∫–∞—á–∞—Ç—å Excel –æ—Ç—á–µ—Ç
                            </button>
                        </div>
                    `;

                    safeShowAlert('‚úÖ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');

                } else {
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
                    const errorMessage = data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    content.innerHTML = `
                        <div class="error-message">
                            ‚ùå ${errorMessage}
                        </div>
                        <div style="margin: 20px 0;">
                            <button onclick="initCalendar()" style="width: 100%; padding: 15px; background: #2196F3; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                        </div>
                    `;

                    safeShowAlert('‚ùå ' + errorMessage);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
                content.innerHTML = `
                    <div class="error-message">
                        ‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}
                    </div>
                    <div style="margin: 20px 0;">
                        <button onclick="initCalendar()" style="width: 100%; padding: 15px; background: #2196F3; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
                            üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                        </button>
                    </div>
                `;

                safeShowAlert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
        function downloadPeriodReport() {
            if (!selectedStartDate || !selectedEndDate) {
                safeShowAlert('–û—à–∏–±–∫–∞: –¥–∞—Ç—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã');
                return;
            }

            try {
                const startDateStr = selectedStartDate.toISOString().split('T')[0];
                const endDateStr = selectedEndDate.toISOString().split('T')[0];

                const downloadUrl = `/api/download-period-report?start_date=${startDateStr}&end_date=${endDateStr}`;

                console.log('–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞:', downloadUrl);

                // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.download = `–û—Ç—á–µ—Ç_${startDateStr}_–ø–æ_${endDateStr}.xlsx`;
                link.target = '_blank'; // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                safeShowAlert('üìä –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –Ω–∞—á–∞—Ç–æ!');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:', error);
                safeShowAlert('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è: ' + error.message);
            }
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        let searchTimeout = null;
        let allStores = [];
        let currentPage = 1;
        let storesPerPage = 30;
        let isSearchMode = false;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–∫–∞–Ω–µ—Ä–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞
        let scannerStream = null;
        let isScanning = false;

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤
        async function searchStores() {
            const query = document.getElementById('store-search').value.trim();

            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä –¥–ª—è –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–æ–∏—Å–∫–∞
            searchTimeout = setTimeout(async () => {
                if (query.length === 0) {
                    // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –ø—É—Å—Ç–æ–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
                    isSearchMode = false;
                    currentPage = 1;
                    displayCurrentPage();
                    return;
                }

                if (query.length < 2) {
                    // –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –∑–∞–ø—Ä–æ—Å
                    return;
                }

                try {
                    isSearchMode = true;
                    const response = await fetch(`/api/search-stores/${currentNetwork.id}?q=${encodeURIComponent(query)}`);
                    const data = await response.json();

                    if (data.success) {
                        displayStores(data.stores, true); // true = —Ä–µ–∂–∏–º –ø–æ–∏—Å–∫–∞
                    } else {
                        console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', data.error);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤:', error);
                }
            }, 300); // –ó–∞–¥–µ—Ä–∂–∫–∞ 300–º—Å
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤
        function displayStores(stores, searchMode = false) {
            const content = document.getElementById('store-content');
            const paginationContainer = document.getElementById('pagination-container');

            if (stores.length === 0) {
                content.innerHTML = `
                    <div class="loading">
                        <p>üîç –ú–∞–≥–∞–∑–∏–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
                    </div>
                `;
                paginationContainer.style.display = 'none';
                return;
            }

            // –í —Ä–µ–∂–∏–º–µ –ø–æ–∏—Å–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
            if (searchMode) {
                paginationContainer.style.display = 'none';
            } else {
                paginationContainer.style.display = 'flex';
            }

            let html = '';
            stores.forEach(store => {
                const statusIcon = store.status === 'checked' ? '‚úÖ' : '‚è≥';
                const statusClass = store.status === 'checked' ? 'checked' : '';

                html += `
                    <div class="store-item ${statusClass}" onclick="selectStore(${store.id}, '${store.name}', '${store.address.replace(/'/g, "\\'")}')">
                        <div class="store-status">${statusIcon}</div>
                        <div class="store-number">üè™ ${store.name}</div>
                        <div class="store-address">üìç ${store.address}</div>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function displayCurrentPage() {
            if (allStores.length === 0) return;

            const startIndex = (currentPage - 1) * storesPerPage;
            const endIndex = startIndex + storesPerPage;
            const currentStores = allStores.slice(startIndex, endIndex);

            displayStores(currentStores, false);
            updatePaginationInfo();
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        function updatePaginationInfo() {
            const totalPages = Math.ceil(allStores.length / storesPerPage);
            const paginationInfo = document.getElementById('pagination-info');
            const prevButton = document.getElementById('prev-page');
            const nextButton = document.getElementById('next-page');

            paginationInfo.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages} (${allStores.length} –º–∞–≥–∞–∑–∏–Ω–æ–≤)`;

            prevButton.disabled = currentPage <= 1;
            nextButton.disabled = currentPage >= totalPages;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function changePage(direction) {
            const totalPages = Math.ceil(allStores.length / storesPerPage);

            if (direction === -1 && currentPage > 1) {
                currentPage--;
            } else if (direction === 1 && currentPage < totalPages) {
                currentPage++;
            }

            displayCurrentPage();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadRegions() {
            const content = document.getElementById('region-content');

            try {
                const response = await fetch('/api/regions');
                const data = await response.json();

                if (data.success && data.regions.length > 0) {
                    let regionsHtml = '';
                    data.regions.forEach(region => {
                        regionsHtml += `
                            <div class="list-item" onclick="selectRegion(${region.id}, '${region.name}')">
                                <h3>üåç ${region.name}</h3>
                                <p>–†–µ–≥–∏–æ–Ω –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</p>
                            </div>
                        `;
                    });
                    content.innerHTML = regionsHtml;
                } else {
                    content.innerHTML = '<div class="error-message">–†–µ–≥–∏–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                }
            } catch (error) {
                content.innerHTML = `<div class="error-message">–û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        async function loadNetworks() {
            const content = document.getElementById('network-content');

            if (!currentRegion) {
                content.innerHTML = '<div class="error-message">–†–µ–≥–∏–æ–Ω –Ω–µ –≤—ã–±—Ä–∞–Ω</div>';
                return;
            }

            try {
                const response = await fetch(`/api/networks/${currentRegion.id}`);
                const data = await response.json();

                let networksHtml = '';

                if (data.success && data.networks.length > 0) {
                    data.networks.forEach(network => {
                        networksHtml += `
                            <div class="list-item" onclick="selectNetwork(${network.id}, '${network.name}')">
                                <h3>üè¨ ${network.name}</h3>
                                <p>–¢–æ—Ä–≥–æ–≤–∞—è —Å–µ—Ç—å</p>
                            </div>
                        `;
                    });
                } else {
                    networksHtml += '<div class="error-message">–°–µ—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                }

                content.innerHTML = networksHtml;
            } catch (error) {
                content.innerHTML = `<div class="error-message">–û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        async function loadStores() {
            const content = document.getElementById('store-content');

            if (!currentNetwork) {
                content.innerHTML = '<div class="error-message">–°–µ—Ç—å –Ω–µ –≤—ã–±—Ä–∞–Ω–∞</div>';
                return;
            }

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            document.getElementById('store-search').value = '';
            currentPage = 1;
            isSearchMode = false;

            try {
                const response = await fetch(`/api/stores/${currentNetwork.id}`);
                const data = await response.json();

                if (data.success && data.stores.length > 0) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –º–∞–≥–∞–∑–∏–Ω—ã
                    allStores = data.stores;

                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    displayCurrentPage();
                } else {
                    content.innerHTML = '<div class="error-message">–ú–∞–≥–∞–∑–∏–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                    document.getElementById('pagination-container').style.display = 'none';
                }
            } catch (error) {
                content.innerHTML = `<div class="error-message">–û—à–∏–±–∫–∞: ${error.message}</div>`;
                document.getElementById('pagination-container').style.display = 'none';
            }
        }

        async function loadNomenclature() {
            const content = document.getElementById('nomenclature-content');

            if (!currentStore) {
                content.innerHTML = '<div class="error-message">–ú–∞–≥–∞–∑–∏–Ω –Ω–µ –≤—ã–±—Ä–∞–Ω</div>';
                return;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞–≥–∞–∑–∏–Ω–µ
            document.getElementById('store-info').innerHTML = `
                <strong>üè™ ${currentStore.name}</strong><br>
                <small>üìç ${currentStore.address}</small>
            `;

            try {
                const response = await fetch(`/api/nomenclature/${currentStore.id}`);
                const data = await response.json();

                if (data.success && data.items.length > 0) {
                    nomenclatureItems = data.items;
                    checkedItems = new Set(data.checked || []);

                    renderNomenclature();
                } else {
                    content.innerHTML = '<div class="error-message">–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>';
                }
            } catch (error) {
                content.innerHTML = `<div class="error-message">–û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        function renderNomenclature() {
            const content = document.getElementById('nomenclature-content');
            let nomenclatureHtml = '';

            nomenclatureItems.forEach((item, index) => {
                const isChecked = checkedItems.has(item);
                const icon = isChecked ? '‚úÖ' : '‚òëÔ∏è';
                const checkedClass = isChecked ? 'checked' : '';

                nomenclatureHtml += `
                    <div class="nomenclature-item ${checkedClass}" onclick="toggleItem('${item}', ${index})">
                        <span class="icon">${icon}</span>
                        <span>${item}</span>
                    </div>
                `;
            });

            content.innerHTML = nomenclatureHtml;
        }

        async function loadTodayReport() {
            const content = document.getElementById('today-report-content');
            const today = new Date().toLocaleDateString('ru-RU');
            document.getElementById('today-date').textContent = today;

            try {
                const response = await fetch('/api/today-report');
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö');
                }

                let html = `
                    <div class="report-info">
                        <h3>üìä –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –º–∞–≥–∞–∑–∏–Ω–æ–≤: ${data.stores_count}</h3>
                        <p>üìÖ –î–∞—Ç–∞: ${data.date}</p>
                `;

                if (data.stores_count > 0) {
                    html += `
                        <p>üì¶ –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫: ${data.total_checks || 0}</p>
                        <p>‚úÖ –¢–æ–≤–∞—Ä–æ–≤ –≤ –Ω–∞–ª–∏—á–∏–∏: ${data.total_present || 0}</p>
                    `;
                }
                html += `</div>`;

                if (data.stores_count > 0) {
                    // –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è Excel –æ—Ç—á–µ—Ç–∞
                    html += `
                        <div style="margin: 16px 0;">
                            <button onclick="downloadTodayExcelReport()" 
                                    style="width: 100%; padding: 16px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
                                üìä –°–∫–∞—á–∞—Ç—å Excel –æ—Ç—á–µ—Ç
                            </button>
                        </div>
                    `;

                    html += `<h3>üè™ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã:</h3>`;

                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –º–∞–≥–∞–∑–∏–Ω–µ
                    data.stores.forEach(store => {
                        html += `
                            <div class="list-item" style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div style="flex: 1;">
                                        <h4 style="margin: 0 0 4px 0; color: #2196F3;">üè¨ ${store.network_name}</h4>
                                        <p style="margin: 0 0 4px 0; font-weight: 600;">üìç –ú–∞–≥–∞–∑–∏–Ω ‚Ññ${store.number}</p>
                                        <p style="margin: 0 0 8px 0; font-size: 14px; color: #666;">${store.address}</p>
                                        <div style="display: flex; gap: 16px; font-size: 14px;">
                                            <span>üì¶ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: ${store.total_checks}</span>
                                            <span>‚úÖ –í –Ω–∞–ª–∏—á–∏–∏: ${store.present_items}</span>
                                            <span style="color: ${store.completion_rate >= 80 ? '#4CAF50' : store.completion_rate >= 50 ? '#FF9800' : '#f44336'};">
                                                üìà ${store.completion_rate}%
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += `
                        <div class="error-message">
                            ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
                        </div>
                    `;
                }

                content.innerHTML = html;

                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram
                if (data.stores_count > 0) {
                    tg.MainButton.setText('üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –≤ Telegram');
                    tg.MainButton.show();
                    tg.MainButton.onClick(async () => {
                        try {
                            const response = await fetch('/api/send-today-report', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' }
                            });
                            const result = await response.json();

                            if (result.success) {
                                safeShowAlert('‚úÖ –û—Ç—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram!');
                            } else {
                                safeShowAlert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                            }
                        } catch (error) {
                            safeShowAlert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message);
                        }
                    });
                } else {
                    tg.MainButton.hide();
                }

            } catch (error) {
                content.innerHTML = `
                    <div class="error-message">
                        ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}
                    </div>
                `;
                tg.MainButton.hide();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è Excel –æ—Ç—á–µ—Ç–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
        async function downloadTodayExcelReport() {
            const button = event.target;
            const originalText = button.textContent;

            try {
                button.textContent = '‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞...';
                button.disabled = true;

                console.log('–û—Ç–∫—Ä—ã–≤–∞–µ–º Excel –æ—Ç—á–µ—Ç...');

                // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É
                const reportUrl = '/api/download-today-report';

                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ/–≤–∫–ª–∞–¥–∫–µ - —ç—Ç–æ —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
                const newWindow = window.open(reportUrl, '_blank');

                if (newWindow) {
                    console.log('–û—Ç—á–µ—Ç –æ—Ç–∫—Ä—ã—Ç –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ');
                    safeShowAlert('‚úÖ Excel –æ—Ç—á–µ—Ç –æ—Ç–∫—Ä—ã—Ç! –í—ã –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –µ–≥–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞.');
                } else {
                    // –ï—Å–ª–∏ popup –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É
                    console.log('Popup –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, —Å–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É');

                    const linkDiv = document.createElement('div');
                    linkDiv.innerHTML = `
                        <div style="background: #4CAF50; color: white; padding: 16px; border-radius: 8px; margin: 16px 0; text-align: center;">
                            <p style="margin: 0 0 12px 0;">üìä Excel –æ—Ç—á–µ—Ç –≥–æ—Ç–æ–≤!</p>
                            <a href="${reportUrl}" target="_blank" 
                               style="background: white; color: #4CAF50; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: bold;">
                               üìä –û—Ç–∫—Ä—ã—Ç—å Excel –æ—Ç—á–µ—Ç
                            </a>
                            <p style="margin: 12px 0 0 0; font-size: 12px; opacity: 0.9;">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –≤—ã—à–µ</p>
                        </div>
                    `;

                    button.parentNode.insertBefore(linkDiv, button.nextSibling);

                    // –£–±–∏—Ä–∞–µ–º —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
                    setTimeout(() => {
                        if (linkDiv.parentNode) {
                            linkDiv.parentNode.removeChild(linkDiv);
                        }
                    }, 30000);

                    safeShowAlert('‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ Excel –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω–∞! –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ—ë –Ω–∏–∂–µ.');
                }

                button.textContent = originalText;
                button.disabled = false;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ—Ç—á–µ—Ç–∞:', error);
                safeShowAlert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);

                button.textContent = originalText;
                button.disabled = false;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –≤—ã–±–æ—Ä–∞
        function selectRegion(id, name) {
            currentRegion = { id, name };
            showNetworkScreen();
        }

        function selectNetwork(id, name) {
            currentNetwork = { id, name };
            showStoreScreen();
        }

        function selectStore(id, name, address) {
            currentStore = {
                id: id,
                name: name,
                address: address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω'
            };
            showNomenclatureScreen();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã
        async function toggleItem(item, index) {
            console.log(`üîÑ toggleItem –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞: "${item}"`);

            if (checkedItems.has(item)) {
                // –°–Ω–∏–º–∞–µ–º –æ—Ç–º–µ—Ç–∫—É —Å —Ç–æ–≤–∞—Ä–∞
                console.log(`‚ùå –°–Ω–∏–º–∞–µ–º –æ—Ç–º–µ—Ç–∫—É —Å —Ç–æ–≤–∞—Ä–∞: "${item}"`);
                checkedItems.delete(item);
                renderNomenclature();
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤ –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ (–ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∑–µ–ª–µ–Ω—ã–º)
                console.log(`‚úÖ –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∑–µ–ª–µ–Ω—ã–º: "${item}"`);
                checkedItems.add(item);
                renderNomenclature();

                console.log(`üí∞ –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–Ω –¥–ª—è —Ç–æ–≤–∞—Ä–∞: "${item}"`);

                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–Ω
                const priceCheckResult = await checkPriceForItem(item);

                // –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã –±—ã–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞, —Å–Ω–∏–º–∞–µ–º –æ—Ç–º–µ—Ç–∫—É
                if (!priceCheckResult) {
                    console.log(`‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã –æ—Ç–º–µ–Ω–µ–Ω–∞, —Å–Ω–∏–º–∞–µ–º –æ—Ç–º–µ—Ç–∫—É —Å —Ç–æ–≤–∞—Ä–∞: "${item}"`);
                    checkedItems.delete(item);
                    renderNomenclature();
                } else {
                    console.log(`‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞: "${item}"`);
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–Ω –¥–ª—è —Ç–æ–≤–∞—Ä–∞
        async function checkPriceForItem(productName) {
            console.log(`üí∞ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–Ω –¥–ª—è —Ç–æ–≤–∞—Ä–∞: "${productName}"`);

            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–µ—Ç–∏
                if (!currentNetwork || !currentNetwork.id) {
                    console.error('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ–∫—É—â–µ–π —Å–µ—Ç–∏');
                    alert('‚ùå –û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–µ—Ç–∏. –¢–æ–≤–∞—Ä —Å–Ω—è—Ç —Å –æ—Ç–º–µ—Ç–∫–∏.');
                    return false;
                }

                console.log(`üåê –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}" –≤ —Å–µ—Ç–∏ ${currentNetwork.id}`);

                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞ –≤ —Å–µ—Ç–∏
                const response = await fetch('/api/get-last-price', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        network_id: currentNetwork.id,
                        product_name: productName
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log(`üìä –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}":`, data);

                if (data.success && data.price_data) {
                    // –ï—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –≤ —Å–µ—Ç–∏ - –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                    console.log(`üí∞ –ù–∞–π–¥–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
                    const priceData = data.price_data;
                    const promoText = priceData.has_promo && priceData.promo_price ?
                        `\nüî• –ê–∫—Ü–∏–æ–Ω–Ω–∞—è: ${priceData.promo_price} —Ä—É–±.` : '';

                    const message = `üí∞ –ü–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –≤ —Å–µ—Ç–∏:\n` +
                        `üè™ –ú–∞–≥–∞–∑–∏–Ω ‚Ññ${priceData.store_number} (${priceData.check_date})\n` +
                        `üè∑Ô∏è –û–±—ã—á–Ω–∞—è: ${priceData.regular_price} —Ä—É–±.${promoText}\n\n` +
                        `–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —ç—Ç—É —Ü–µ–Ω—É –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"?`;

                    const confirmPrice = confirm(message);
                    console.log(`ü§î –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${confirmPrice ? '–ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª' : '–æ—Ç–∫–ª–æ–Ω–∏–ª'} —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ü–µ–Ω—É`);

                    if (confirmPrice) {
                        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ü–µ–Ω—É, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–Ω–µ
                        const promoResult = await askPromoPrice(productName, priceData.regular_price, priceData.promo_price, priceData.has_promo);
                        if (promoResult === null) {
                            console.log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ –∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–Ω—ã –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
                            return false;
                        }

                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ—Å—Ç–∞—Ç–∫–∞–º
                        const stockResult = await askStockQuantity(productName);
                        if (stockResult === null) {
                            console.log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ –æ—Å—Ç–∞—Ç–∫–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
                            return false;
                        }

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                        console.log(`üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
                        await savePriceData(productName, priceData.regular_price, promoResult.promoPrice, promoResult.hasPromo, stockResult);
                        return true;
                    } else {
                        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Ü–µ–Ω—É
                        console.log(`‚úèÔ∏è –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Ü–µ–Ω—É –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
                        return await requestNewPrice(productName);
                    }
                } else {
                    // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ü–µ–Ω–µ - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—É—é
                    console.log(`üìù –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ü–µ–Ω–µ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}", –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—É—é`);
                    return await requestNewPrice(productName);
                }
            } catch (error) {
                console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–Ω—ã –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}":`, error);
                alert(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ü–µ–Ω—ã: ${error.message}. –¢–æ–≤–∞—Ä —Å–Ω—è—Ç —Å –æ—Ç–º–µ—Ç–∫–∏.`);
                return false;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –Ω–æ–≤–æ–π —Ü–µ–Ω—ã
        async function requestNewPrice(productName) {
            console.log(`‚úèÔ∏è –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Ü–µ–Ω—É –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);

            const regularPrice = prompt(`üí∞ –í–≤–µ–¥–∏—Ç–µ –æ–±—ã—á–Ω—É—é —Ü–µ–Ω—É –¥–ª—è "${productName}" (–≤ —Ä—É–±–ª—è—Ö):`);

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ —Ü–µ–Ω—ã
            if (regularPrice === null) {
                console.log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ –æ–±—ã—á–Ω–æ–π —Ü–µ–Ω—ã –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
                return false;
            }

            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω—ã
            if (!regularPrice || regularPrice.trim() === '' || isNaN(regularPrice) || parseFloat(regularPrice) <= 0) {
                console.log(`‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞ "${regularPrice}" –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
                alert('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞. –¢–æ–≤–∞—Ä —Å–Ω—è—Ç —Å –æ—Ç–º–µ—Ç–∫–∏.');
                return false;
            }

            const regPrice = parseFloat(regularPrice);
            console.log(`üí∞ –û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}": ${regPrice} —Ä—É–±.`);

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–Ω–µ
            console.log(`üî• –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–Ω–µ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
            const promoResult = await askPromoPrice(productName, regPrice);
            if (promoResult === null) {
                console.log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ –∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–Ω—ã –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
                return false;
            }

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ—Å—Ç–∞—Ç–∫–∞–º
            console.log(`üì¶ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ—Å—Ç–∞—Ç–∫–∞–º –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
            const stockResult = await askStockQuantity(productName);
            if (stockResult === null) {
                console.log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ –æ—Å—Ç–∞—Ç–∫–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
                return false;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            console.log(`üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);
            await savePriceData(productName, regPrice, promoResult.promoPrice, promoResult.hasPromo, stockResult);
            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–Ω—ã
        async function askPromoPrice(productName, regularPrice, existingPromoPrice = null, existingHasPromo = false) {
            console.log(`üî• –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∞–∫—Ü–∏–æ–Ω–Ω—É—é —Ü–µ–Ω—É –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}" (–æ–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞: ${regularPrice})`);

            // –ï—Å–ª–∏ –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –µ—ë
            if (existingHasPromo && existingPromoPrice) {
                console.log(`üî• –ù–∞–π–¥–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞: ${existingPromoPrice} —Ä—É–±.`);
                const confirmExistingPromo = confirm(`üî• –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∞–∫—Ü–∏–æ–Ω–Ω—É—é —Ü–µ–Ω—É ${existingPromoPrice} —Ä—É–±. –¥–ª—è "${productName}"?`);
                if (confirmExistingPromo) {
                    console.log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–∫—Ü–∏–æ–Ω–Ω—É—é —Ü–µ–Ω—É`);
                    return { promoPrice: existingPromoPrice, hasPromo: true };
                }
                console.log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–∫—Ü–∏–æ–Ω–Ω—É—é —Ü–µ–Ω—É`);
            }

            // –°–ø—Ä–∞—à–∏–≤–∞–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ü–∏—è
            const hasPromo = confirm(`üî• –ï—Å—Ç—å –ª–∏ –∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞ –Ω–∞ "${productName}"?`);
            console.log(`üî• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${hasPromo ? '–ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª' : '–æ—Ç–∫–ª–æ–Ω–∏–ª'} –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ü–∏–∏`);

            if (!hasPromo) {
                return { promoPrice: null, hasPromo: false };
            }

            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∞–∫—Ü–∏–æ–Ω–Ω—É—é —Ü–µ–Ω—É
            const promoPrice = prompt(`üî• –í–≤–µ–¥–∏—Ç–µ –∞–∫—Ü–∏–æ–Ω–Ω—É—é —Ü–µ–Ω—É –¥–ª—è "${productName}" (–≤ —Ä—É–±–ª—è—Ö):`);

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª
            if (promoPrice === null) {
                console.log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ –∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–Ω—ã`);
                return null;
            }

            // –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–Ω—ã
            if (!promoPrice || promoPrice.trim() === '' || isNaN(promoPrice) || parseFloat(promoPrice) <= 0) {
                console.log(`‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞: "${promoPrice}"`);
                alert('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞. –¢–æ–≤–∞—Ä —Å–Ω—è—Ç —Å –æ—Ç–º–µ—Ç–∫–∏.');
                return null;
            }

            const promoPriceFloat = parseFloat(promoPrice);
            console.log(`üî• –í–≤–µ–¥–µ–Ω–∞ –∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞: ${promoPriceFloat} —Ä—É–±.`);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞ –º–µ–Ω—å—à–µ –æ–±—ã—á–Ω–æ–π
            if (promoPriceFloat >= regularPrice) {
                console.log(`‚ùå –ê–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞ (${promoPriceFloat}) >= –æ–±—ã—á–Ω–æ–π (${regularPrice})`);
                alert(`‚ùå –ê–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞ (${promoPriceFloat}) –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞ –æ–±—ã—á–Ω–æ–π (${regularPrice}). –¢–æ–≤–∞—Ä —Å–Ω—è—Ç —Å –æ—Ç–º–µ—Ç–∫–∏.`);
                return null;
            }

            console.log(`‚úÖ –ê–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞ –≤–∞–ª–∏–¥–Ω–∞: ${promoPriceFloat} —Ä—É–±.`);
            return { promoPrice: promoPriceFloat, hasPromo: true };
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤
        async function askStockQuantity(productName) {
            console.log(`üì¶ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ—Å—Ç–∞—Ç–∫–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}"`);

            const stockQuantity = prompt(`üì¶ –í–≤–µ–¥–∏—Ç–µ –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞ "${productName}" (—à—Ç—É–∫):`);

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª
            if (stockQuantity === null) {
                console.log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ –æ—Å—Ç–∞—Ç–∫–æ–≤`);
                return null;
            }

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–∏–ª –ø—É—Å—Ç—ã–º - —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ –ø—Ä–æ–ø—É—Å–∫ (—Ä–∞–∑—Ä–µ—à–∞–µ–º)
            if (stockQuantity === '' || stockQuantity.trim() === '') {
                console.log(`‚è≠Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–ø—É—Å—Ç–∏–ª –≤–≤–æ–¥ –æ—Å—Ç–∞—Ç–∫–æ–≤`);
                return null; // null –æ–∑–Ω–∞—á–∞–µ—Ç "–Ω–µ —É–∫–∞–∑–∞–Ω–æ"
            }

            // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤
            if (isNaN(stockQuantity) || parseInt(stockQuantity) < 0) {
                console.log(`‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏: "${stockQuantity}"`);
                alert('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞—Ç–∫–æ–≤. –¢–æ–≤–∞—Ä —Å–Ω—è—Ç —Å –æ—Ç–º–µ—Ç–∫–∏.');
                return null;
            }

            const stockQty = parseInt(stockQuantity);
            console.log(`üì¶ –í–≤–µ–¥–µ–Ω—ã –æ—Å—Ç–∞—Ç–∫–∏: ${stockQty} —à—Ç.`);
            return stockQty;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ü–µ–Ω–µ –∏ –æ—Å—Ç–∞—Ç–∫–∞—Ö
        async function savePriceData(productName, regularPrice, promoPrice, hasPromo, stockQuantity) {
            console.log(`üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}":`, {
                regularPrice,
                promoPrice,
                hasPromo,
                stockQuantity,
                store_id: currentStore?.id
            });

            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –º–∞–≥–∞–∑–∏–Ω–µ
                if (!currentStore || !currentStore.id) {
                    throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ–∫—É—â–µ–º –º–∞–≥–∞–∑–∏–Ω–µ');
                }

                const requestData = {
                    store_id: currentStore.id,
                    product_name: productName,
                    regular_price: regularPrice,
                    promo_price: promoPrice,
                    has_promo: hasPromo || false,
                    stock_quantity: stockQuantity
                };

                console.log(`üåê –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:`, requestData);

                const response = await fetch('/api/save-price', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log(`üìä –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:`, data);

                if (data.success) {
                    console.log(`‚úÖ –¶–µ–Ω–∞ –∏ –æ—Å—Ç–∞—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è —Ç–æ–≤–∞—Ä–∞: ${productName}`);

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
                    let savedInfo = `‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –¥–ª—è "${productName}":\nüí∞ –¶–µ–Ω–∞: ${regularPrice} —Ä—É–±.`;
                    if (hasPromo && promoPrice) {
                        savedInfo += `\nüî• –ê–∫—Ü–∏—è: ${promoPrice} —Ä—É–±.`;
                    }
                    if (stockQuantity !== null && stockQuantity !== undefined) {
                        savedInfo += `\nüì¶ –û—Å—Ç–∞—Ç–∫–∏: ${stockQuantity} —à—Ç.`;
                    } else {
                        savedInfo += `\nüì¶ –û—Å—Ç–∞—Ç–∫–∏: –Ω–µ —É–∫–∞–∑–∞–Ω—ã`;
                    }

                    console.log(`üì¢ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:`, savedInfo);

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    safeShowAlert(savedInfo);
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', data.error);
                    throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
            } catch (error) {
                console.error(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "${productName}":`, error);
                alert(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}`);
                throw error; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –¥–∞–ª—å—à–µ
            }
        }

        async function saveProgress() {
            try {
                const response = await fetch('/api/save-progress', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        store_id: currentStore.id,
                        checked_items: Array.from(checkedItems)
                    })
                });

                const data = await response.json();

                if (data.success) {
                    safeShowAlert('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                    showStoreScreen();
                } else {
                    safeShowAlert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + data.error);
                }
            } catch (error) {
                safeShowAlert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        let isSending = false;

        function debugLog(message, level = 'INFO') {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${level}: ${message}`);

            // –¢–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            const debugDiv = document.getElementById('debug-log');
            if (debugDiv) {
                debugDiv.style.display = 'block';
                debugDiv.innerHTML += `[${timestamp}] ${level}: ${message}<br>`;
                debugDiv.scrollTop = debugDiv.scrollHeight;
            }
        }

        async function finalSaveAndSend() {
            debugLog('üñ±Ô∏è –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å" –Ω–∞–∂–∞—Ç–∞', 'CLICK');

            if (isSending) {
                debugLog('‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º', 'WARNING');
                return;
            }
            if (!currentStore || nomenclatureItems.length === 0) {
                debugLog('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏', 'ERROR');
                safeShowAlert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏');
                return;
            }

            debugLog(`üìä –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏: –º–∞–≥–∞–∑–∏–Ω=${currentStore.name}, —Ç–æ–≤–∞—Ä–æ–≤=${nomenclatureItems.length}, –æ—Ç–º–µ—á–µ–Ω–æ=${checkedItems.size}`, 'DATA');

            isSending = true;

            // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            const sendButton = document.querySelector('.send-button');
            const originalText = sendButton.textContent;
            sendButton.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            sendButton.disabled = true;

            debugLog('üîí –ö–Ω–æ–ø–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É', 'STATUS');

            try {
                // –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                debugLog('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ /api/save-and-send', 'REQUEST');

                const savePayload = {
                    store_id: currentStore.id,
                    store_name: currentStore.name,
                    checked_items: Array.from(checkedItems),
                    total_items: nomenclatureItems.length
                };

                debugLog(`üìã Payload: ${JSON.stringify(savePayload)}`, 'DATA');

                const saveResponse = await fetch('/api/save-and-send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(savePayload)
                });

                debugLog(`üì• –û—Ç–≤–µ—Ç –æ—Ç /api/save-and-send: HTTP ${saveResponse.status}`, 'RESPONSE');

                const saveData = await saveResponse.json();
                debugLog(`üìÑ –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞: ${JSON.stringify(saveData)}`, 'DATA');

                if (saveData.success) {
                    debugLog('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram', 'SUCCESS');

                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const inspectorName = document.getElementById('inspector-name').value.trim();
                    const userComment = document.getElementById('report-comment').value.trim();

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
                    if (!inspectorName) {
                        alert('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –§–ò–û');
                        return;
                    }

                    // –°–æ–∑–¥–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    let telegramMessage = `üìã –û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã\n\n`;
                    telegramMessage += `üè™ –ú–∞–≥–∞–∑–∏–Ω: ${currentStore.name}\n`;
                    telegramMessage += `üìç –ê–¥—Ä–µ—Å: ${currentStore.address}\n`;
                    telegramMessage += `üÜî ID –º–∞–≥–∞–∑–∏–Ω–∞: ${currentStore.id}\n`;
                    telegramMessage += `üìÖ –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${new Date().toLocaleDateString('ru-RU')}\n`;
                    telegramMessage += `üë§ –ü—Ä–æ–≤–µ—Ä–∏–ª: ${inspectorName}\n`;
                    telegramMessage += `üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${checkedItems.size} –∏–∑ ${nomenclatureItems.length} —Ç–æ–≤–∞—Ä–æ–≤ –≤ –Ω–∞–ª–∏—á–∏–∏`;

                    if (userComment) {
                        telegramMessage += `\n\nüí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${userComment}`;
                    }

                    debugLog('üì§ –°–æ–∑–¥–∞–µ–º Excel –æ—Ç—á–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram', 'REQUEST');

                    const telegramResponse = await fetch('/api/send-to-telegram', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: telegramMessage,
                            store_id: currentStore.id,
                            store_name: currentStore.name,
                            inspector_name: inspectorName,
                            comment: userComment
                        })
                    });

                    debugLog(`üì• –û—Ç–≤–µ—Ç –æ—Ç Telegram API: HTTP ${telegramResponse.status}`, 'RESPONSE');

                    const telegramData = await telegramResponse.json();
                    debugLog(`üìÑ Telegram –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(telegramData)}`, 'DATA');

                    if (telegramData.success) {
                        debugLog('‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ', 'SUCCESS');
                        const reportFile = telegramData.report_file || '–æ—Ç—á–µ—Ç';
                        const successMessage = `‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!\nüìä Excel –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: ${reportFile.split('/').pop()}\nüì§ –ì–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ –≥—Ä—É–ø–ø—É!`;

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                        safeShowAlert(successMessage);
                    } else {
                        debugLog('‚ö†Ô∏è Telegram –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å', 'WARNING');
                        safeShowAlert('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –≥—Ä—É–ø–ø—É');
                    }

                    debugLog('üè† –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', 'NAVIGATION');
                    showMainScreen();
                } else {
                    debugLog(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${saveData.error}`, 'ERROR');
                    safeShowAlert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + saveData.error);
                }
            } catch (error) {
                debugLog(`üí• –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`, 'ERROR');
                debugLog(`üìç Stack trace: ${error.stack}`, 'ERROR');
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π alert –¥–ª—è –æ—à–∏–±–æ–∫
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                debugLog('üîì –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É', 'STATUS');
                isSending = false;
                sendButton.textContent = originalText;
                sendButton.disabled = false;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        console.log('Telegram Web App –∑–∞–≥—Ä—É–∂–µ–Ω');

        if (tg.sendData) {
            tg.sendData(JSON.stringify({
                action: 'app_ready',
                timestamp: Date.now()
            }));
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–∫–∞–Ω–µ—Ä–æ–º —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞
        function openBarcodeScanner() {
            const modal = document.getElementById('scanner-modal');
            modal.style.display = 'flex';

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('manual-barcode').value = '';

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            document.getElementById('start-scan-btn').style.display = 'inline-block';
            document.getElementById('stop-scan-btn').style.display = 'none';

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            document.getElementById('scanner-status').textContent = '–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ" –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤—Ä—É—á–Ω—É—é';
        }

        function closeBarcodeScanner() {
            const modal = document.getElementById('scanner-modal');

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            stopScanning();

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.style.display = 'none';

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('manual-barcode').value = '';
        }

        function startScanning() {
            const status = document.getElementById('scanner-status');
            const startBtn = document.getElementById('start-scan-btn');
            const stopBtn = document.getElementById('stop-scan-btn');

            status.textContent = 'üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–º–µ—Ä—ã...';
            startBtn.style.display = 'none';
            stopBtn.style.display = 'inline-block';

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º QuaggaJS
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-video-container'),
                    constraints: {
                        width: 400,
                        height: 300,
                        facingMode: "environment" // –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞
                    }
                },
                locator: {
                    patchSize: "medium",
                    halfSample: true
                },
                numOfWorkers: 2,
                frequency: 10,
                decoder: {
                    readers: [
                        "code_128_reader",
                        "ean_reader",
                        "ean_8_reader",
                        "code_39_reader",
                        "code_39_vin_reader",
                        "codabar_reader",
                        "upc_reader",
                        "upc_e_reader",
                        "i2of5_reader"
                    ]
                },
                locate: true
            }, function (err) {
                if (err) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ QuaggaJS:', err);
                    status.textContent = '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥.';
                    startBtn.style.display = 'inline-block';
                    stopBtn.style.display = 'none';
                    return;
                }

                console.log("QuaggaJS –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ");
                status.textContent = 'üì∑ –ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞. –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥';
                isScanning = true;
                Quagga.start();
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            Quagga.onDetected(function (result) {
                const code = result.codeResult.code;
                console.log('–û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω —à—Ç—Ä–∏—Ö-–∫–æ–¥:', code);

                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                stopScanning();

                // –ò—â–µ–º —Ç–æ–≤–∞—Ä
                const foundProduct = findProductByBarcode(code);

                if (foundProduct) {
                    closeBarcodeScanner();
                    showFoundProduct(foundProduct, code);
                    scrollToProduct(foundProduct);
                } else {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
                    document.getElementById('manual-barcode').value = code;
                    status.textContent = `üì∑ –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω –∫–æ–¥: ${code}. –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä—É—á–Ω–æ–π –ø–æ–∏—Å–∫.`;
                    startBtn.style.display = 'inline-block';
                    stopBtn.style.display = 'none';
                }
            });
        }

        function stopScanning() {
            if (isScanning) {
                Quagga.stop();
                isScanning = false;

                const startBtn = document.getElementById('start-scan-btn');
                const stopBtn = document.getElementById('stop-scan-btn');
                const status = document.getElementById('scanner-status');

                startBtn.style.display = 'inline-block';
                stopBtn.style.display = 'none';
                status.textContent = '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ" –¥–ª—è –ø–æ–≤—Ç–æ—Ä–∞.';
            }
        }

        function searchByBarcode() {
            const barcodeInput = document.getElementById('manual-barcode');
            const barcode = barcodeInput.value.trim();

            if (!barcode) {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥');
                return;
            }

            // –ò—â–µ–º —Ç–æ–≤–∞—Ä –ø–æ —à—Ç—Ä–∏—Ö-–∫–æ–¥—É –≤ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–µ
            const foundProduct = findProductByBarcode(barcode);

            if (foundProduct) {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–∫–∞–Ω–µ—Ä
                closeBarcodeScanner();

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
                showFoundProduct(foundProduct, barcode);

                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ç–æ–≤–∞—Ä—É –≤ —Å–ø–∏—Å–∫–µ
                scrollToProduct(foundProduct);

            } else {
                alert(`‚ùå –¢–æ–≤–∞—Ä —Å —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–º "${barcode}" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–µ –º–∞–≥–∞–∑–∏–Ω–∞`);
            }
        }

        function findProductByBarcode(barcode) {
            const searchTerm = barcode.toLowerCase();

            // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const testCodes = {
                '123': '–º–æ–ª–æ–∫–æ',
                '456': '—Ö–ª–µ–±',
                '789': '–º–∞—Å–ª–æ',
                '101': '—Å—ã—Ä'
            };

            // –ï—Å–ª–∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥, –∏—â–µ–º –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É —Å–ª–æ–≤—É
            const searchWord = testCodes[barcode] || searchTerm;

            return nomenclatureItems.find(item =>
                item.toLowerCase().includes(searchWord) ||
                item.toLowerCase().includes(searchTerm) ||
                (barcode.length >= 3 && item.toLowerCase().includes(barcode.slice(-3)))
            );
        }

        function showFoundProduct(productName, barcode) {
            const resultDiv = document.getElementById('barcode-result');
            const productDiv = document.getElementById('found-product');

            productDiv.innerHTML = `
                <div style="margin: 8px 0; padding: 10px; background: #f0f8ff; border-radius: 5px;">
                    <strong>üéØ ${productName}</strong><br>
                    <small>–ù–∞–π–¥–µ–Ω –ø–æ –∫–æ–¥—É: ${barcode}</small>
                </div>
                <div style="margin-top: 10px;">
                    <button onclick="markProductFound('${productName.replace(/'/g, "\\'")}'); hideBarcodeResult();" 
                            style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px; font-size: 14px;">
                        ‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–∞–π–¥–µ–Ω
                    </button>
                    <button onclick="hideBarcodeResult();" 
                            style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                        ‚ùå –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            `;

            resultDiv.style.display = 'block';

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                hideBarcodeResult();
            }, 15000);
        }

        function markProductFound(productName) {
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤ –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ
            checkedItems.add(productName);
            renderNomenclature();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            alert(`‚úÖ –¢–æ–≤–∞—Ä "${productName}" –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã–π`);
        }

        function hideBarcodeResult() {
            document.getElementById('barcode-result').style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–ª–∞–¥–∫–∏
        function toggleDebugMode() {
            debugMode = !debugMode;
            const debugLog = document.getElementById('debug-log');
            if (debugMode) {
                debugLog.style.display = 'block';
                addDebugLog('üîç –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω');
            } else {
                debugLog.style.display = 'none';
            }
        }

        function addDebugLog(message) {
            if (!debugMode) return;

            const debugContent = document.getElementById('debug-content');
            const timestamp = new Date().toLocaleTimeString();
            debugContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;

            // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
            const debugLog = document.getElementById('debug-log');
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º console.log –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        const originalConsoleLog = console.log;
        console.log = function (...args) {
            originalConsoleLog.apply(console, args);
            if (debugMode) {
                addDebugLog(args.join(' '));
            }
        };

        function scrollToProduct(productName) {
            // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–æ–≤–∞—Ä–∞ –≤ —Å–ø–∏—Å–∫–µ –∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–µ–º—É
            const nomenclatureItems = document.querySelectorAll('.nomenclature-item');

            nomenclatureItems.forEach(item => {
                const itemText = item.textContent || item.innerText;
                if (itemText.includes(productName)) {
                    item.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });

                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
                    item.style.border = '3px solid #FF6B35';
                    item.style.boxShadow = '0 0 10px rgba(255, 107, 53, 0.5)';

                    // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        item.style.border = '';
                        item.style.boxShadow = '';
                    }, 3000);
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
        function quickSearch(code) {
            document.getElementById('manual-barcode').value = code;
            searchByBarcode();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞
        document.addEventListener('DOMContentLoaded', function () {
            const manualBarcodeInput = document.getElementById('manual-barcode');
            if (manualBarcodeInput) {
                manualBarcodeInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        searchByBarcode();
                    }
                });
            }
        });

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/sw.js')
                    .then(function (registration) {
                        console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
                        showInstallPrompt();
                    })
                    .catch(function (error) {
                        console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
                    });
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
        let deferredPrompt;
        let installButton = null;

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ä–∞–∑—É –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        function createInstallButton() {
            if (installButton) return;

            installButton = document.createElement('button');
            installButton.id = 'install-pwa-btn';
            installButton.innerHTML = 'üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
            installButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                border: none;
                border-radius: 25px;
                padding: 12px 20px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
                z-index: 1000;
                animation: pulse 2s infinite;
                display: block;
            `;

            installButton.addEventListener('click', async () => {
                if (deferredPrompt) {
                    // –î–ª—è Chrome/Edge
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log('PWA —É—Å—Ç–∞–Ω–æ–≤–∫–∞:', outcome);
                    if (outcome === 'accepted') {
                        hideInstallButton();
                    }
                } else {
                    // –î–ª—è –¥—Ä—É–≥–∏—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                    showInstallInstructions();
                }
            });

            document.body.appendChild(installButton);

            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—É–ª—å—Å–∞—Ü–∏–∏
            if (!document.getElementById('pulse-animation')) {
                const style = document.createElement('style');
                style.id = 'pulse-animation';
                style.textContent = `
                    @keyframes pulse {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.05); }
                        100% { transform: scale(1); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function hideInstallButton() {
            if (installButton) {
                installButton.remove();
                installButton = null;
            }
        }

        function showInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);

            let instructions = '';
            if (isIOS) {
                instructions = `
                    üì± –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ iPhone/iPad:
                    1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" ‚¨ÜÔ∏è
                    2. –í—ã–±–µ—Ä–∏—Ç–µ "–ù–∞ —ç–∫—Ä–∞–Ω ¬´–î–æ–º–æ–π¬ª"
                    3. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å"
                `;
            } else if (isAndroid) {
                instructions = `
                    üì± –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ Android:
                    1. –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞ (‚ãÆ)
                    2. –í—ã–±–µ—Ä–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω"
                    3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
                `;
            } else {
                instructions = `
                    üíª –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:
                    1. –ù–∞–π–¥–∏—Ç–µ –∏–∫–æ–Ω–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
                    2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞
                    3. –í—ã–±–µ—Ä–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
                `;
            }

            alert(instructions);
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA: –°–æ–±—ã—Ç–∏–µ beforeinstallprompt');
            e.preventDefault();
            deferredPrompt = e;
            createInstallButton();
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏—è beforeinstallprompt
        setTimeout(() => {
            if (!installButton && !window.matchMedia('(display-mode: standalone)').matches) {
                createInstallButton();
            }
        }, 3000);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            const installBtn = document.getElementById('install-pwa-btn');
            if (installBtn) {
                installBtn.remove();
            }
        });
    </script>
</body>

</html>